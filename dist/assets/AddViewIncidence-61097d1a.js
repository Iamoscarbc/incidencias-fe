import{a as A}from"./axios-f9cbc706.js";import{m as X}from"./index-a08ccca5.js";import{d as D,g as G,t as L,v as E,x as q,a as H,y as P,z as Y,A as J,B as Q,c5 as K,c6 as W,c as Z,c7 as $,c8 as x,c9 as _,b as ee,I as ae,G as te,h as oe,i as ne,r as v,aZ as le,ca as ie,cb as se,_ as re,j as I,o as l,J as d,l as c,w as r,M as S,K as O,k as p,n as b,L as U,N as u,m as k}from"./index-44ebac36.js";const de=D({components:{IonPage:G,IonHeader:L,IonToolbar:E,IonTitle:q,IonContent:H,IonCard:P,IonCardTitle:Y,IonCardHeader:J,IonCardContent:Q,IonButtons:K,IonBackButton:W,IonInput:Z,IonSelect:$,IonSelectOption:x,IonTextarea:_,IonIcon:ee,IonButton:ae},computed:{...te("usuarios",["user"]),invalidForm(){return!this.form.categorie||!this.form.description||!this.form.documentNumber||this.form.documentNumber.length!=8},invalidFormUpdate(){return!this.form.specialist||this.form.documents.length==0}},methods:{openFileManager(){this.$refs.fileManager.click()}},setup(){const e=oe(),t=ne(),w=v(""),y=v(""),z=v([]),N=v([]),s=v({date:t.params.id?"23/10/2023 23:35:40":w,categorie:null,specialist:null,description:null,documentNumber:null,documents:[],timeline:[]}),f=v([]),h=async o=>{for(let n=0;n<o.target.files.length;n++){const i=o.target.files[n];s.value.documents.push(i),f.value.push(URL.createObjectURL(i))}},T=async(o,n)=>{s.value.documents.splice(n,1),f.value.splice(n,1)},C=()=>{const o=X();w.value=o.format("DD/MM/YYYY HH:mm:ss")};le(async()=>{y.value=!0,await g(),await a(),t.params.id?await B(t.params.id):(await C(),setInterval(C,1e3)),y.value=!1});const g=async()=>{let o=localStorage.getItem("token");const i=(await A.get("/api/userByProfile/653752a46f75ce25da5cb7dd",{headers:{Authorization:"Bearer "+o}})).data;i.success&&(z.value=i.data)},a=async()=>{let o=localStorage.getItem("token");const i=(await A.get("/api/categories",{headers:{Authorization:"Bearer "+o}})).data;i.success&&(N.value=i.data)},B=async o=>{let n=localStorage.getItem("token");const m=(await A.get("/api/incidence/"+o,{headers:{Authorization:"Bearer "+n}})).data;m.success&&(s.value=m.data)};return{listOfSpecialist:z,listOfCategories:N,form:s,addCircleOutline:ie,closeCircleOutline:se,urlDocuments:f,loading:y,selectImage:h,deleteImage:T,createIncidence:async()=>{let{date:o,categorie:n,description:i,documentNumber:m}=s.value;if(n&&i&&m){let M={date:o,categorie:n,description:i,documentNumber:m},j=localStorage.getItem("token");const F=(await A.post("/api/incidences",M,{headers:{Authorization:"Bearer "+j}})).data;F.success&&e.replace({name:"DetalleIncidencia",params:{id:F.data}})}else console.log("Completa el formulario")},updateIncidence:async()=>{let{specialist:o,documents:n}=s.value;if(o||n){var i=new FormData;for(let V=0;V<n.length;V++){const F=n[V];i.append("file",F)}i.append("specialist",o);let m=localStorage.getItem("token");(await A.put("/api/incidence/"+t.params.id,i,{headers:{Authorization:"Bearer "+m,"Content-Type":"multipart/form-data"}})).data.success&&e.back()}else console.log("Completa el formulario")},finalizeIncidence:async()=>{let o=localStorage.getItem("token");(await A.put("/api/finalize-incidence/"+t.params.id,{},{headers:{Authorization:"Bearer "+o}})).data.success&&e.back()},validateNumber:async(o,n)=>{s.value[o].length>n&&(s.value[o]=s.value[o].substr(0,n))}}}}),ue="data:image/png;base64,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";const me={key:0,class:"ion-padding add-view-incidence"},ce=k("div",{slot:"label"},"Fecha y Hora",-1),pe=k("div",{slot:"label"},"Usuario Registrador",-1),fe=k("div",{slot:"label"},"DNI Alumno",-1),ge=k("div",{slot:"label"},"Incidencia",-1),Ae={key:1,class:"container-images"},ve={class:"images"},Ie=["src"],Ce=["src"],be={key:2,src:ue};function ke(e,t,w,y,z,N){const s=I("ion-input"),f=I("ion-select-option"),h=I("ion-select"),T=I("ion-textarea"),C=I("ion-icon"),g=I("ion-button");return e.loading?u("",!0):(l(),d("div",me,[c(s,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=a=>e.form.date=a),"label-placement":"floating",fill:"outline",disabled:""},{default:r(()=>[ce]),_:1},8,["modelValue"]),c(s,{value:e.user.firstname+" "+e.user.lastname,"label-placement":"floating",fill:"outline",disabled:""},{default:r(()=>[pe]),_:1},8,["value"]),c(h,{modelValue:e.form.categorie,"onUpdate:modelValue":t[1]||(t[1]=a=>e.form.categorie=a),label:"CategorÃ­a","label-placement":"floating",fill:"outline",disabled:!!e.$route.params.id,interface:"action-sheet"},{default:r(()=>[(l(!0),d(S,null,O(e.listOfCategories,a=>(l(),p(f,{value:a._id},{default:r(()=>[b(U(a.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","disabled"]),e.$route.params.id?(l(),p(h,{key:0,modelValue:e.form.specialist,"onUpdate:modelValue":t[2]||(t[2]=a=>e.form.specialist=a),label:"Especialista","label-placement":"floating",fill:"outline",disabled:e.form.timeline.length!=0&&!!e.form.timeline[2].completed,interface:"action-sheet"},{default:r(()=>[(l(!0),d(S,null,O(e.listOfSpecialist,a=>(l(),p(f,{value:a._id},{default:r(()=>[b(U(a.firstname)+" "+U(a.lastname),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","disabled"])):u("",!0),c(s,{modelValue:e.form.documentNumber,"onUpdate:modelValue":t[3]||(t[3]=a=>e.form.documentNumber=a),"label-placement":"floating",fill:"outline",type:"number",disabled:!!e.$route.params.id,onIonBlur:t[4]||(t[4]=a=>e.validateNumber("documentNumber",8))},{default:r(()=>[fe]),_:1},8,["modelValue","disabled"]),c(T,{modelValue:e.form.description,"onUpdate:modelValue":t[5]||(t[5]=a=>e.form.description=a),"label-placement":"floating",fill:"outline","auto-grow":"",disabled:!!e.$route.params.id},{default:r(()=>[ge]),_:1},8,["modelValue","disabled"]),e.$route.params.id?(l(),d("div",Ae,[e.form.timeline.length!=0&&!e.form.timeline[1].completed&&e.user.idProfile._id!="653752a46f75ce25da5cb7dd"?(l(),d("div",{key:0,class:"area__image",onClick:t[7]||(t[7]=a=>e.openFileManager())},[c(C,{icon:e.addCircleOutline,size:"large"},null,8,["icon"]),k("input",{type:"file",accept:".jpg, .jpeg, .pdf",multiple:"",ref:"fileManager",onChange:t[6]||(t[6]=(...a)=>e.selectImage&&e.selectImage(...a)),style:{display:"none"}},null,544)])):u("",!0),(l(!0),d(S,null,O(e.form.documents,(a,B)=>(l(),d("div",ve,[e.form.timeline.length!=0&&!e.form.timeline[1].completed?(l(),p(g,{key:0,color:"danger",onClick:R=>e.deleteImage(a,B)},{default:r(()=>[c(C,{icon:e.closeCircleOutline,size:"large"},null,8,["icon"])]),_:2},1032,["onClick"])):u("",!0),a.type=="image/jpeg"?(l(),d(S,{key:1},[e.form.timeline.length!=0&&!e.form.timeline[1].completed?(l(),d("img",{key:0,src:e.urlDocuments[B]},null,8,Ie)):(l(),d("img",{key:1,src:"http://206.189.176.12:3002/api/files/"+e.$route.params.id+"/"+a.name},null,8,Ce))],64)):(l(),d("img",be))]))),256))])):u("",!0),e.$route.params.id?u("",!0):(l(),p(g,{key:2,expand:"full",onClick:t[8]||(t[8]=a=>e.createIncidence()),disabled:e.invalidForm},{default:r(()=>[b("Crear Incidencia")]),_:1},8,["disabled"])),e.form.timeline.length!=0&&!e.form.timeline[2].completed?(l(),p(g,{key:3,expand:"full",onClick:t[9]||(t[9]=a=>e.updateIncidence()),disabled:e.invalidFormUpdate},{default:r(()=>[b("Actualizar Incidencia")]),_:1},8,["disabled"])):u("",!0),e.user.idProfile._id=="653752a46f75ce25da5cb7dd"&&e.form.timeline.length!=0&&e.form.timeline[1].completed&&!e.form.timeline[2].completed?(l(),p(g,{key:4,expand:"full",color:"danger",onClick:t[10]||(t[10]=a=>e.finalizeIncidence())},{default:r(()=>[b("Finalizar Incidencia")]),_:1})):u("",!0)]))}const we=re(de,[["render",ke]]);export{we as A};
